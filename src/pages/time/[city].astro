---
/**
 * SEO Pages for City Time (English)
 * Generates static pages for each city
 * Example: /time/tokyo/, /time/london/, /time/new-york/
 */

import BaseLayout from '../../layouts/BaseLayout.astro';
import timezonesData from '../../data/timezones.json';

// Generate all possible city pages
export async function getStaticPaths() {
  return timezonesData.map(city => ({
    params: { city: city.id },
  }));
}

const { city: cityId } = Astro.params;

const cityData = timezonesData.find(tz => tz.id === cityId);

if (!cityData) {
  return Astro.redirect('/world-clock/');
}

// Calculate current time in this timezone
const currentTime = new Date().toLocaleString('en-US', {
  timeZone: cityData.timezone,
  hour: 'numeric',
  minute: '2-digit',
  hour12: true,
});

const currentDate = new Date().toLocaleString('en-US', {
  timeZone: cityData.timezone,
  weekday: 'long',
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const title = `Current Time in ${cityData.name}, ${cityData.country} - World Clock`;
const description = `What time is it in ${cityData.name}? Check the current local time in ${cityData.name}, ${cityData.country}. View timezone, UTC offset, and time difference from your location.`;
const keywords = `time in ${cityData.name}, ${cityData.name} time, ${cityData.country} time, ${cityData.name} timezone, current time ${cityData.name}`;
---

<BaseLayout title={title} description={description} keywords={keywords}>
  <div class="container mx-auto px-4 py-12">
    <!-- Back to World Clock -->
    <div class="mb-6">
      <a
        href="/world-clock"
        class="inline-flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors"
      >
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to World Clock
      </a>
    </div>

    <div class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4">
        Current Time in {cityData.name}
      </h1>
      <p class="text-lg text-gray-600 dark:text-gray-400">
        {cityData.country}
      </p>
    </div>

    <!-- Live Clock -->
    <div class="max-w-2xl mx-auto mb-12">
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
        <div class="text-center mb-6">
          <div id="live-time" class="text-6xl md:text-7xl font-mono font-bold text-blue-600 dark:text-blue-400 mb-2">
            {currentTime}
          </div>
          <div id="live-date" class="text-lg text-gray-600 dark:text-gray-400">
            {currentDate}
          </div>
        </div>

        <div class="grid grid-cols-2 gap-4 text-center border-t border-gray-200 dark:border-gray-700 pt-6">
          <div>
            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">Timezone</div>
            <div class="font-semibold text-gray-900 dark:text-white">{cityData.timezone}</div>
          </div>
          <div>
            <div class="text-sm text-gray-600 dark:text-gray-400 mb-1">UTC Offset</div>
            <div class="font-semibold text-gray-900 dark:text-white">{cityData.utcOffset}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Information -->
    <div class="max-w-4xl mx-auto prose dark:prose-invert">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
        About Time in {cityData.name}
      </h2>

      <div class="space-y-4 text-gray-600 dark:text-gray-400">
        <p>
          The current time in <strong>{cityData.name}, {cityData.country}</strong> is displayed above.
          {cityData.name} is located in the {cityData.timezone} timezone with a UTC offset of {cityData.utcOffset}.
        </p>

        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mt-6 mb-3">
          Timezone Information
        </h3>
        <ul class="list-disc list-inside space-y-2">
          <li><strong>City:</strong> {cityData.name}</li>
          <li><strong>Country:</strong> {cityData.country}</li>
          <li><strong>Continent:</strong> {cityData.continent}</li>
          <li><strong>Timezone:</strong> {cityData.timezone}</li>
          <li><strong>UTC Offset:</strong> {cityData.utcOffset}</li>
        </ul>

        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mt-6 mb-3">
          When to Call {cityData.name}
        </h3>
        <p>
          If you need to schedule a call or meeting with someone in {cityData.name}, make sure to check
          the current time difference between your location and {cityData.name}. The best time to call is
          typically during normal business hours (9 AM - 5 PM) in the local timezone.
        </p>

        <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mt-6">
          <p class="text-sm text-blue-900 dark:text-blue-100 mb-0">
            <strong>ðŸ’¡ Tip:</strong> This page shows the live time in {cityData.name}. The clock updates automatically
            every second. Bookmark this page for quick access to {cityData.name} time.
          </p>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<script define:vars={{ timezone: cityData.timezone }}>
  // Update time every second
  function updateTime() {
    const now = new Date();

    const timeString = now.toLocaleString('en-US', {
      timeZone: timezone,
      hour: 'numeric',
      minute: '2-digit',
      second: '2-digit',
      hour12: true,
    });

    const dateString = now.toLocaleString('en-US', {
      timeZone: timezone,
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric',
    });

    const timeEl = document.getElementById('live-time');
    const dateEl = document.getElementById('live-date');

    if (timeEl) timeEl.textContent = timeString;
    if (dateEl) dateEl.textContent = dateString;
  }

  // Update immediately and then every second
  updateTime();
  setInterval(updateTime, 1000);
</script>
